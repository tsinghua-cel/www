<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>System Design | Documentation</title>
    <meta name="description" content="Documents for BunnyFinder framework">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/bf/document/assets/style.DaEsnMNd.css" as="style">
    <link rel="preload stylesheet" href="/bf/document/vp-icons.css" as="style">
    
    <script type="module" src="/bf/document/assets/app.D_E9ekws.js"></script>
    <link rel="preload" href="/bf/document/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/bf/document/assets/chunks/theme.C4HepbXQ.js">
    <link rel="modulepreload" href="/bf/document/assets/chunks/framework.CLBIubxr.js">
    <link rel="modulepreload" href="/bf/document/assets/design.md.BvkWd0mr.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/bf/document/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bf/document/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://www.cryptoeco.org/" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Website</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Tutorials</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/installation.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Installation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/configuration.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/usage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Basic Usage</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/advanced-usage.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Advanced Usage</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Development</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/db.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Database Statement</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/bf/document/strategy.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Strategy Category</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/tsinghua-cel/attacker-service" target="_blank" rel="noreferrer" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Github</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _bf_document_design" data-v-39a288b8><div><h1 id="system-design" tabindex="-1">System Design <a class="header-anchor" href="#system-design" aria-label="Permalink to &quot;System Design&quot;">​</a></h1><h2 id="crafting-protocol-aware-llm-prompts" tabindex="-1">Crafting Protocol-Aware LLM Prompts <a class="header-anchor" href="#crafting-protocol-aware-llm-prompts" aria-label="Permalink to &quot;Crafting Protocol-Aware LLM Prompts&quot;">​</a></h2><p>To generate meaningful and effective attack strategies, BunnyFinder’s Strategy Generator (SG) relies on carefully engineered prompts that help large language models (LLMs) understand and reason through the specific dynamics of Ethereum’s Proof of Stake (PoS) consensus mechanism. The prompts are carefully crafted around three key pillars:</p><h3 id="environment-setting" tabindex="-1">Environment Setting <a class="header-anchor" href="#environment-setting" aria-label="Permalink to &quot;Environment Setting&quot;">​</a></h3><p>The first step in guiding the LLM involves providing it with a structured, protocol-specific foundation. This includes the following core elements:</p><ol><li><p>Ethereum Protocol: The LLM learns essential details about Ethereum’s network structure, such as slot and epoch intervals, checkpoint finalization, and the HLMD GHOST fork choice rule that helps determine the canonical chain.</p></li><li><p>Adversarial Constraints: The LLM is constrained by a set of adversarial conditions, such as the network’s synchronous nature, discrete 4-second delay units, and uniform Byzantine strategies (e.g., a coordinated group of malicious validators).</p></li><li><p>Incentive Rules: The model is also familiarized with Ethereum’s incentive system, which includes rewards for timely attestations, penalties for equivocation (e.g., double-signing), and conditions under which validators are slashed (i.e., punished).</p></li></ol><p>Example Prompt:</p><p>&quot;Ethereum PoS assumes that the network is partially synchronous, i.e., there exists an unknown upper bound $\Delta$ for message propagation and processing. In the paper, our analysis focuses on the attacks when the network is synchronous, assuming that $\Delta$ is known by all validators. In Ethereum, time is divided into epochs. Each epoch includes 32 slots where each slot lasts for 12 seconds. For our purpose, we call four seconds (1/3 of a slot) a time unit.&quot;</p><h2 id="strategy-space-definition" tabindex="-1">Strategy Space Definition <a class="header-anchor" href="#strategy-space-definition" aria-label="Permalink to &quot;Strategy Space Definition&quot;">​</a></h2><p>Once the environment is established, the next step is to clearly define the strategy space. The LLM is restricted to two primary types of manipulation, which form the basis of potential attack strategies:</p><ul><li>Order Manipulation: This involves delaying certain actions (e.g., block proposals) by a fixed time, with the delay expressed in discrete units (multiples of 4 seconds). The model is restricted to these increments to simplify the design space and prevent overly complex strategies.</li><li>Content Manipulation: This focuses on altering mutable fields within Ethereum’s protocol, such as modifying block parent hashes or attestation checkpoints. These are the only targets for content manipulation to maintain consistency with Ethereum’s structure.</li></ul><p>Example Output should like this:</p><p>{ &quot;slot&quot;: &quot;5&quot;, &quot;actions&quot;: { &quot;BlockBeforeBroadCast&quot;: &quot;return&quot;, &quot;AttestBeforeSign&quot;: &quot;modifyAttestHead:0&quot; } }</p><h2 id="input-output-standardization" tabindex="-1">Input/Output Standardization <a class="header-anchor" href="#input-output-standardization" aria-label="Permalink to &quot;Input/Output Standardization&quot;">​</a></h2><p>To ensure that the strategies generated by the LLM can be directly implemented and tested, BunnyFinder uses a structured format for input and output: the Strategy Specification Format (SSF). SSF is a JSON template that maps the generated actions to specific slots within Ethereum’s blocks and attestations.</p><p>This standardized format allows the Strategy Executor (SE) to automatically parse and apply these strategies, adjusting validator clients in real-time to simulate the attack. The executor’s ability to read SSF ensures a smooth flow of information from the LLM’s output to the actual execution environment.</p><p><strong>Iterative Refinement</strong></p><p>After executing the generated strategies, the State Analyzer (SA) evaluates the outcomes and metrics. The analysis focuses on various key performance indicators:</p><ul><li>Reward Ratios: Comparison between the rewards earned by Byzantine (malicious) and honest validators.</li><li>Penalties: Calculation of penalties incurred by validators for equivocation (signing conflicting blocks or attestations) or missed attestations.</li><li>Finalization Delays: The impact of the attack on the finalization process, including potential delays or even chain splits.</li></ul><p>Based on the analysis, the LLM undergoes an iterative refinement process, where it learns from its initial strategy and adapts to improve future outcomes. Specifically, the model may:</p><ul><li>Prune Ineffective Strategies: Attack strategies that result in negligible reward reductions (e.g., less than 5%) are discarded or minimized in subsequent rounds.</li><li>Amplify Successful Tactics: Strategies that show significant promise—such as increasing the delay from 1 to 3 units for a higher reward impact—are amplified and tested further.</li><li>Test Threshold Effects: The model may explore how the attack’s success varies when certain parameters, like the number of Byzantine validators, are adjusted. For example, it might test how a strategy performs when 33% of validators are compromised versus when fewer are involved.</li></ul><p>This iterative process helps BunnyFinder refine attack strategies and better understand Ethereum’s vulnerabilities, allowing for increasingly sophisticated attacks to be designed and tested with minimal human intervention.</p><p>This version adds more structure and clarity, making it easier for readers to follow the design steps while giving them a detailed look at how BunnyFinder generates and refines attack strategies. The key process steps, like strategy definition, prompt design, and iterative feedback, are clearly laid out to demonstrate how the system evolves with each interaction.</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/bf/document/installation.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Installation</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the MIT License.</p><p class="copyright" data-v-e315a0ad>Copyright © 2024 BunnyFinder Framework. All rights reserved.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced-usage.md\":\"BXniHzrJ\",\"configuration.md\":\"j05zkDAB\",\"db.md\":\"BjDeJvzI\",\"deploy.md\":\"CQYrZycg\",\"design.md\":\"BvkWd0mr\",\"index.md\":\"8Ex-HA9f\",\"installation.md\":\"Bgr_CCnN\",\"overview.md\":\"D2mcha1v\",\"strategy.md\":\"ypmRhrAh\",\"usage.md\":\"BvplN_er\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Documentation\",\"description\":\"Documents for BunnyFinder framework\",\"base\":\"/bf/document/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Website\",\"link\":\"https://www.cryptoeco.org/\"}],\"sidebar\":[{\"text\":\"Tutorials\",\"items\":[{\"text\":\"Installation\",\"link\":\"/installation\"},{\"text\":\"Configuration\",\"link\":\"/configuration\"},{\"text\":\"Basic Usage\",\"link\":\"/usage\"},{\"text\":\"Advanced Usage\",\"link\":\"/advanced-usage\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"Database Statement\",\"link\":\"/db\"},{\"text\":\"Strategy Category\",\"link\":\"/strategy\"},{\"text\":\"Github\",\"link\":\"https://github.com/tsinghua-cel/attacker-service\"}]}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2024 BunnyFinder Framework. All rights reserved.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>